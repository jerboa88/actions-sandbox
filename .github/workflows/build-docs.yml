name: 📝 Build Docs
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - master
    paths:
      - 'src/docs/**'
jobs:
  build-docs:
    name: build
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: 📂 Checkout Repo
        uses: actions/checkout@v4

      - name: 📝 Build Docs with Dagger
        uses: dagger/dagger-for-github@8.0.0
        env:
          GITHUB_CONTEXT_JSON: '${{ toJSON(github) }}'
        with:
          version: latest
          verb: call
          module: github.com/jerboa88/actions-sandbox-2/dagger
          args: >-2
              --source-dir='./'
              --default-templates-dir='https://github.com/jerboa88/actions-sandbox-2.git#main:templates'
              --token='${{ secrets.GITHUB_TOKEN }}'
            with-nunjucks-context
              --data-file='project.json' --output-key='pj'
            with-nunjucks-context-from-github
              --github-context-secret='env://GITHUB_CONTEXT_JSON'
            build-and-commit-docs
              --with-paths='src/docs/CODE_OF_CONDUCT.md.njk:docs/CODE_OF_CONDUCT.md'
              --with-paths='src/docs/CODE_OF_CONDUCT.md.njk:docs/CODE_OF_CONDUCT_2.md'
              --with-paths='src/docs/CODE_OF_CONDUCT.md.njk:docs/CODE_OF_CONDUCT_3.md'
              --with-paths='src/docs/CODE_OF_CONDUCT.md.njk:docs/CODE_OF_CONDUCT_4.md'
          cloud-token: ${{ secrets.DAGGER_CLOUD_TOKEN }}
